# Android Network Security Configuration

## Overview

This project uses an Expo Config Plugin to automatically configure Android network security settings, allowing the app to connect to HTTP (cleartext) endpoints. This is essential for:
- Local development servers
- Private IP addresses (172.x.x.x, 192.168.x.x, 10.x.x.x)
- Production server at `172.31.235.136:8080`

## How It Works

The custom Expo Config Plugin (`plugins/with-network-security-config.js`) automatically:

1. **Creates** `android/app/src/main/res/xml/network_security_config.xml`
2. **Modifies** `android/app/src/main/AndroidManifest.xml` to:
   - Enable cleartext traffic: `android:usesCleartextTraffic="true"`
   - Reference the network security config: `android:networkSecurityConfig="@xml/network_security_config"`

## For New Team Members / Fresh Clone

When you clone the project and need to generate the Android folder:

```bash
# Option 1: Generate Android project (plugin runs automatically)
npx expo prebuild --platform android

# Option 2: Or use the npm script
npm run android
```

The plugin will automatically:
- ✅ Create the network security config file
- ✅ Update AndroidManifest.xml with the necessary attributes
- ✅ Configure permissions for HTTP traffic

**No manual steps required!** The plugin handles everything automatically.

## If Android Folder Already Exists

If you already have an `android/` folder that was generated before this plugin was added:

```bash
# Delete the existing android folder
rm -rf android  # Linux/Mac
# or
rmdir /s android  # Windows

# Regenerate with the plugin
npx expo prebuild --platform android
```

Or use the clean flag:
```bash
npx expo prebuild --platform android --clean
```

## What Gets Created

### network_security_config.xml
Located at: `android/app/src/main/res/xml/network_security_config.xml`

Allows cleartext HTTP traffic to:
- Private IP ranges (172.16.0.0/12, 192.168.0.0/16, 10.0.0.0/8)
- Production server: `172.31.235.136`
- Localhost addresses: `10.0.2.2`, `localhost`, `127.0.0.1`

### AndroidManifest.xml Updates
The plugin automatically adds to the `<application>` tag:
```xml
android:usesCleartextTraffic="true"
android:networkSecurityConfig="@xml/network_security_config"
```

## Why This Is Needed

Android 9 (API level 28) and higher blocks cleartext (HTTP) traffic by default for security. Without this configuration:
- ❌ APK builds cannot connect to HTTP endpoints
- ❌ Local development servers won't work
- ❌ Private IP addresses are blocked

With this plugin:
- ✅ HTTP connections work in both debug and release builds
- ✅ Local development works seamlessly
- ✅ Production server connections work

## Troubleshooting

### Plugin Not Running?
1. Check that `./plugins/with-network-security-config.js` is in `app.json` plugins array
2. Verify the plugin file exists in the `plugins/` directory
3. Try deleting `android/` folder and running `npx expo prebuild --platform android` again

### Still Getting Network Errors?
1. Verify `network_security_config.xml` exists in `android/app/src/main/res/xml/`
2. Check `AndroidManifest.xml` has the network security attributes
3. Rebuild the APK: `npm run build:apk`

## Files in Git

✅ **Committed to Git:**
- `plugins/with-network-security-config.js` - The plugin code
- `app.json` - Contains plugin reference
- `plugins/README.md` - Plugin documentation

❌ **NOT in Git (auto-generated):**
- `android/` folder - Generated by Expo prebuild
- `android/app/src/main/res/xml/network_security_config.xml` - Created by plugin
- Modified `AndroidManifest.xml` - Modified by plugin

## Related Documentation

- [Expo Config Plugins](https://docs.expo.dev/config-plugins/introduction/)
- [Android Network Security Config](https://developer.android.com/training/articles/security-config)
- [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) - Network connection issues
